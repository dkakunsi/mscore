version: "3"

services:

  flowable-idm:
    image: flowable/flowable-idm:latest
    container_name: flowable-idm
    ports:
      - 3001:8080
    environment:
      - SERVER_PORT=8080
      - SPRING_DATASOURCE_DRIVER-CLASS-NAME=org.postgresql.Driver
      - SPRING_DATASOURCE_URL=jdbc:postgresql://rdbms:5432/flowable
      - SPRING_DATASOURCE_USERNAME=$POSTGRES_USERNAME
      - SPRING_DATASOURCE_PASSWORD=$POSTGRES_PASSWORD

  flowable-admin:
    image: flowable/flowable-admin
    container_name: flowable-admin
    ports:
      - 3002:8080
    environment:
      - SERVER_PORT=8080
      - SPRING_DATASOURCE_DRIVER-CLASS-NAME=org.postgresql.Driver
      - SPRING_DATASOURCE_URL=jdbc:postgresql://rdbms:5432/workflow
      - SPRING_DATASOURCE_USERNAME=$POSTGRES_USERNAME
      - SPRING_DATASOURCE_PASSWORD=$POSTGRES_PASSWORD
      - FLOWABLE_COMMON_APP_IDM-URL=http://flowable-idm:8080/flowable-idm
      - FLOWABLE_COMMON_APP_IDM-ADMIN_USER=admin
      - FLOWABLE_COMMON_APP_IDM-ADMIN_PASSWORD=test
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_PROCESS_SERVER-ADDRESS=http://flowable-task
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_PROCESS_PORT=9999
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_PROCESS_CONTEXT-ROOT=flowable-task
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_PROCESS_REST-ROOT=process-api
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_CMMN_SERVER-ADDRESS=http://flowable-task
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_CMMN_PORT=9999
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_CMMN_CONTEXT-ROOT=flowable-task
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_CMMN_REST-ROOT=cmmn-api
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_DMN_SERVER-ADDRESS=http://flowable-task
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_DMN_PORT=80899990
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_DMN_CONTEXT-ROOT=flowable-task
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_DMN_REST-ROOT=dmn-api
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_FORM_SERVER-ADDRESS=http://flowable-task
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_FORM_PORT=9999
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_FORM_CONTEXT-ROOT=flowable-task
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_FORM_REST-ROOT=form-api
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_CONTENT_SERVER-ADDRESS=http://flowable-task
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_CONTENT_PORT=9999
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_CONTENT_CONTEXT-ROOT=flowable-task
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_CONTENT_REST-ROOT=content-api
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_APP_SERVER-ADDRESS=http://flowable-task
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_APP_PORT=9999
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_APP_CONTEXT-ROOT=flowable-task
      - FLOWABLE_ADMIN_APP_SERVER-CONFIG_APP_REST-ROOT=app-api

  flowable-task:
    image: flowable/flowable-task
    container_name: flowable-task
    ports:
      - 3003:9999
    environment:
      - SERVER_PORT=9999
      - FLOWABLE_COMMON_APP_IDM-URL=http://flowable-idm:8080/flowable-idm
      - FLOWABLE_COMMON_APP_IDM-ADMIN_USER=admin
      - FLOWABLE_COMMON_APP_IDM-ADMIN_PASSWORD=test
      - SPRING_DATASOURCE_DRIVER-CLASS-NAME=org.postgresql.Driver
      - SPRING_DATASOURCE_URL=jdbc:postgresql://rdbms:5432/workflow
      - SPRING_DATASOURCE_USERNAME=$POSTGRES_USERNAME
      - SPRING_DATASOURCE_PASSWORD=$POSTGRES_PASSWORD
